#!/bin/sh
#
# Icetray environment script.
#
# THIS FILE WAS AUTOGENERATED. ANY CHANGES YOU MAKE HERE WILL BE
# LOST. IF YOU FIND YOURSELF NEEDING TO CHANGE THINGS HERE SEE
#
# http://wiki.icecube.wisc.edu/index.php/Shell_Configuration_Tips
#
# If you need to change something here to make things work, that's a bug
# and you should file a ticket at https://github.com/icecube/icetray/issues.
# Thanks for your help!
#

if [ "$1" = "help" ]
    then
    echo "Usage: $0 [SHELL]"
    echo "Spawn a new shell with an Icetray environment loaded"
    echo ""
    echo "SHELL can specified with or without a full path.  If SHELL"
    echo "is omitted the login shell is used by default."
    echo "Examples:"
    echo "   ./env-shell.sh"
    echo "   ./env-shell.sh bash"
    echo "   ./env-shell.sh /path/to/script.py"
    echo ""
    echo "To exit the Icetray environment simply exit the new shell."
    echo ""
    exit 1
fi

if [ -z "$1" ]
    then # user did not specify a shell
    NEW_SHELL=$SHELL
    # only exit if no shell specified on command line *and* env already loaded
    if [ -n "$DST_SHELL" ]
        then
        echo "****************************************************************"
        echo "You are currently in a shell with an Icetray environment loaded."
        echo "Please exit the current shell and re-run $0 from a clean shell."
        echo "****************************************************************"
        echo "Environment not (re)loaded."
        exit 2
    fi
else
    NEW_SHELL=$1
    shift
    ARGV="$@"
fi

_DST_SHELL=$NEW_SHELL

_DST_SRC=@DST_SRC@
_DST_BUILD=@DST_BUILD@
_DST_TESTDATA=@DST_TESTDATA@
_DST_PRODDATA=@DST_PRODDATA@

# Check for DST_BUILD mismatch
if [ -n "$DST_BUILD" -a "$DST_BUILD" != "$_DST_BUILD" ]
then
    echo "****************************************************************"
    echo "DST_BUILD CHANGED"
    echo "It appears that you are attempting to load an icetray environment different"
    echo "than the one already loaded"
    echo "          This DST_BUILD=$_DST_BUILD"
    echo "Already loaded DST_BUILD=$DST_BUILD"
    echo "****************************************************************"
    echo "Environment not (re)loaded."
    exit 2
fi

# Check for valid ROOTSYS
if [ -d "@ROOTSYS@" ]; then

_ROOTSYS=@ROOTSYS@
_LD_LIBRARY_PATH=@CMAKE_BINARY_DIR@/lib:@CMAKE_BINARY_DIR@/lib/tools:${_ROOTSYS}/lib:@GEANT4_LIB_DIR@:$LD_LIBRARY_PATH
_DYLD_LIBRARY_PATH=@CMAKE_BINARY_DIR@/lib:@CMAKE_BINARY_DIR@/lib/tools:${_ROOTSYS}/lib:$DYLD_LIBRARY_PATH

_PYTHONPATH=@CMAKE_BINARY_DIR@/lib:${_ROOTSYS}/lib:$PYTHONPATH
_PATH=@CMAKE_BINARY_DIR@/bin:${_ROOTSYS}/bin:$PATH

else

_ROOTSYS=''
_LD_LIBRARY_PATH=@CMAKE_BINARY_DIR@/lib:@CMAKE_BINARY_DIR@/lib/tools:@GEANT4_LIB_DIR@:$LD_LIBRARY_PATH
_DYLD_LIBRARY_PATH=@CMAKE_BINARY_DIR@/lib:@CMAKE_BINARY_DIR@/lib/tools:$DYLD_LIBRARY_PATH

_PYTHONPATH=@CMAKE_BINARY_DIR@/lib:$PYTHONPATH
_PATH=@CMAKE_BINARY_DIR@/bin:$PATH

fi

_HDF5_USE_FILE_LOCKING=${HDF5_USE_FILE_LOCKING:-FALSE}

TOPBAR="************************************************************************"
WIDTH=`echo "$TOPBAR" | wc -c`

WIDTH=$(( $WIDTH-2 ))

printctr()
{
    LEN=`echo "$*" | wc -c`
    LOFFSET=$(( ($WIDTH-$LEN)/2 ))
    ROFFSET=$(( $WIDTH-$LOFFSET-$LEN ))

    FORMAT="*%${LOFFSET}s%s%${ROFFSET}s*\n"
    printf $FORMAT " " "$*" " "
}

if [ -z "$ARGV" ]
    then
    printf "$TOPBAR\n"
    printctr ""
    printctr "W E L C O M E  to  CRA-TOOLS"
    printctr ""
    printctr ""
    printctr ""
    printf "$TOPBAR\n"
    printf "\n"
    printf "Icetray environment has:\n"
    printf "   DST_SRC       = %s\n" $_DST_SRC
    printf "   DST_BUILD     = %s\n" $_DST_BUILD
    echo   "   Python       =" @PYTHON_VERSION@
fi

if [ -z "$DST_SHELL" ] # a clean, first invocation
    then

    # GEANT4_ENV_VARS pulls in GEANT4 variables,
    # generated by cmake/make_geant4_env.py

    PATH=$_PATH \
    LD_LIBRARY_PATH=$_LD_LIBRARY_PATH \
    DYLD_LIBRARY_PATH=$_DYLD_LIBRARY_PATH \
    PYTHONPATH=$_PYTHONPATH \
    DST_PLATFORM="" \
    DST_SRC=$_DST_SRC \
    DST_BUILD=$_DST_BUILD \
    DST_TESTDATA=$_DST_TESTDATA \
    DST_PRODDATA=$_DST_PRODDATA \
    ROOTSYS=$_ROOTSYS \
    DST_SHELL=$_DST_SHELL \
    HDF5_USE_FILE_LOCKING=$_HDF5_USE_FILE_LOCKING \
    @GEANT4_ENV_VARS@ \
    $NEW_SHELL "$@"

else  # not clean, use previous environment
    $NEW_SHELL "$@"
fi

STATUS=$?

if [ -z "$ARGV" ]
then
    echo "Exited Icetray Environment."
fi
exit $STATUS
